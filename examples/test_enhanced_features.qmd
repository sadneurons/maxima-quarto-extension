---
title: "Enhanced Maxima Features Test"
format: pdf
---

```{r}
#| include: false
source("_extensions/maxima/knitr-engine.R")
```

# Enhanced Feature Testing

## 1. Multiple Figure Formats

### PNG Format (Default)
```{maxima}
#| label: fig-png
#| plot: true
#| fig-cap: "Sine wave in PNG format"
#| fig.align: center
#| out.width: "70%"

plot2d(sin(x), [x, -2*%pi, 2*%pi]);
```

### PDF Format
```{maxima}
#| label: fig-pdf
#| plot: true
#| fig.dev: pdf
#| fig-cap: "Cosine wave in PDF format"
#| fig.align: center

plot2d(cos(x), [x, -2*%pi, 2*%pi]);
```

### SVG Format
```{maxima}
#| label: fig-svg
#| plot: true
#| fig.dev: svg
#| fig-cap: "Tangent function in SVG format"
#| fig.align: right
#| out.width: "60%"

plot2d(tan(x), [x, -%pi, %pi], [y, -5, 5]);
```

## 2. Results Handling Options

### Results: asis (Direct LaTeX/Markdown)
```{maxima}
#| results: asis
#| tex: true

integrate(x^2, x);
```

### Results: markup (Code Block)
```{maxima}
#| results: markup

solve(x^2 - 5*x + 6 = 0, x);
```

### Results: hide (No Output)
```{maxima}
#| results: hide

/* This computes something but doesn't show output */
a: 42;
b: a * 2;
```

### Results: hold (Default Behavior)
```{maxima}
#| results: hold

diff(sin(x)^2, x);
```

## 3. Warning and Message Filtering

### With Warnings and Messages
```{maxima}
#| warning: true
#| message: true
#| tex: true

load("draw");
solve([x+y=1, 2*x-y=2], [x, y]);
```

### Without Warnings and Messages
```{maxima}
#| warning: false
#| message: false
#| tex: true

load("draw");
solve([x+y=1, 2*x-y=2], [x, y]);
```

## 4. Figure Alignment and Sizing

### Left Aligned, Custom Width
```{maxima}
#| label: fig-left
#| plot: true
#| fig.align: left
#| out.width: "50%"
#| fig-cap: "Left-aligned plot at 50% width"

plot2d([sin(x), cos(x)], [x, 0, 2*%pi]);
```

### Center Aligned, Custom Height
```{maxima}
#| label: fig-center
#| plot: true
#| fig.align: center
#| out.width: "80%"
#| out.height: "400px"
#| fig-cap: "Center-aligned plot with custom dimensions"

plot2d(exp(-x^2), [x, -3, 3]);
```

### Right Aligned, Large
```{maxima}
#| label: fig-right
#| plot: true
#| fig.align: right
#| out.width: "90%"
#| fig-cap: "Right-aligned large plot"

plot2d(x*sin(1/x), [x, -1, 1]);
```

## 5. Multiple Plots with Draw Package

### PNG with Draw Backend
```{maxima}
#| label: fig-draw-png
#| plot: true
#| plot_backend: draw
#| fig.dev: png
#| fig-cap: "Multiple functions using draw package (PNG)"
#| fig.align: center

draw2d(
  color = red,
  explicit(sin(x), x, 0, 2*%pi),
  color = blue,
  explicit(cos(x), x, 0, 2*%pi),
  title = "Sine and Cosine"
);
```

### SVG with Draw Backend
```{maxima}
#| label: fig-draw-svg
#| plot: true
#| plot_backend: draw
#| fig.dev: svg
#| fig-cap: "3D surface using draw package (SVG)"
#| fig.align: center
#| out.width: "75%"

draw3d(
  surface_hide = true,
  color = green,
  explicit(sin(x)*cos(y), x, -2, 2, y, -2, 2),
  title = "sin(x)*cos(y)"
);
```

## 6. High-Precision Computation

### Big Float with Precision
```{maxima}
#| bfloat: true
#| fpprec: 50
#| results: markup

%pi;
```

### Regular Float
```{maxima}
#| float: true
#| results: markup

sqrt(2);
```

## 7. Simplification Options

### Trigonometric Simplification
```{maxima}
#| trigsimp: true
#| tex: true

sin(x)^2 + cos(x)^2;
```

### Rational Simplification
```{maxima}
#| ratsimp: true
#| tex: true

(x^2 - 1)/(x - 1);
```

### Factoring
```{maxima}
#| factor: true
#| tex: true

x^2 - 5*x + 6;
```

## 8. Session Persistence Across Chunks

### Define Variables
```{maxima}
#| session: true
#| results: hide

matrix_a: matrix([1, 2], [3, 4]);
matrix_b: matrix([5, 6], [7, 8]);
```

### Use Defined Variables
```{maxima}
#| session: true
#| tex: true

matrix_a . matrix_b;
```

### More Operations on Session Variables
```{maxima}
#| session: true
#| tex: true

determinant(matrix_a);
```

## Summary

This document demonstrates all enhanced features:

1. ✅ Multiple figure formats (PNG, PDF, SVG, EPS)
2. ✅ Results handling (asis, markup, hide, hold)
3. ✅ Warning/message filtering
4. ✅ Figure alignment (left, center, right)
5. ✅ Custom figure sizing (out.width, out.height)
6. ✅ Draw package backend support
7. ✅ High-precision arithmetic
8. ✅ Multiple simplification methods
9. ✅ Session persistence

All features work seamlessly with Quarto's document rendering system!
